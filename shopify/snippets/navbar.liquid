{% comment %}
A word on drop-down menus: Shopify has no concept of them.
Drop-down menus in Shopify themes are a hack that relies on a naming convention.
To create a drop-down menu, the merchant must create a link list that has the same name as the link he wants the drop-down for.
For example, if he wants a drop-down under a 'Shop by brand' link (say, he has such link in his Main Menu), he needs to create a linklist called 'Shop by brand', and populate it with links. Once he has done that, there'll be a drop-down under 'Shop by brand'.
Shopify has a visual how-to guide here: http://docs.shopify.com/manual/your-website/navigation/create-drop-down-menu.
The naming convention hack won't work well if a shop's navigation uses non-English characters. There's a much more verbose coding solution that handles non-English characters here: http://docs.shopify.com/manual/configuration/store-customization/currencies-and-translations/translations/can-i-have-drop-down-menus-that-use-non-english-characters.
A word on sub-categories: Shopify manages sub-categories using product tags: http://docs.shopify.com/manual/configuration/store-customization/page-specific/collections/subcategories
{% endcomment %}


<nav role="navigation" class="flex items-center">
  <ul class="hidden xl:flex gap-[40px]">
    {% for link in linklists.main-menu.links %}
      {% assign has_sub_menu = false %}
      {% assign has_sub_categories = false %}
      {% assign parent_link_active = false %}
      {% assign child_list_handle = link.title | handle %}

      {% if linklists[child_list_handle] and linklists[child_list_handle].links.size > 0 %}
        {% assign has_sub_menu = true %}
        {% for l in linklists[child_list_handle].links %}
          {% if handle != blank and handle == l.object.handle %}
            {% assign parent_link_active = true %}
          {% elsif page_title == l.title %}
            {% assign parent_link_active = true %}
          {% endif %}
        {% endfor %}
      {% elsif link.type == 'collection_link' and link.object.all_tags.size > 0 %}
        {% assign has_sub_categories = true %}
      {% endif %}

      {% capture clsx -%}
        {%- if link.active or parent_link_active -%}
          {%- echo "text-accent-purple font-bold " -%}
        {% else %}
          {%- echo "hover:text-accent-purple " -%}
        {%- endif -%}
        {%- if has_sub_menu or has_sub_categories -%}
          {%- echo "has-dropdown " -%}
        {%- endif -%}
        {%- if forloop.first -%}
          {%- echo "first " -%}
        {%- elsif forloop.last -%}
          {%- echo "last " -%}
        {%- endif -%}
      {%- endcapture %}

      <li class="{{clsx}} text-[16px]">
        <a href="{{ link.url }}" class="flex gap-[10px] items-center text-primary-black ">
          {{ link.title }}
          {% if has_sub_menu or has_sub_categories %}
            <i class="fa fa-angle-down"></i>
          {% endif %}
        </a>
        {% if has_sub_menu or has_sub_categories %}
          <ul>
            {% if has_sub_menu %}
              {% for l in linklists[child_list_handle].links %}
                <li class="{% if l.active %} active{% endif %}">
                  <a href="{{ l.url }}">{{ l.title }}</a>
                </li>
              {% endfor %}
            {% elsif has_sub_categories %}
              {% for tag in link.object.all_tags %}
                <li class="{% if current_tags contains tag %} active{% endif %}">
                  <a href="{{ link.url }}/{{ tag | handle }}">{{ tag }}</a>
                </li>
              {% endfor %}
            {% endif %}
          </ul>
        {% endif %}
      </li>
    {% endfor %}
    <li class="text-[16px] text-accent-purple font-pjs-medium hover:font-bold">
      <a href="#" class="flex gap-[10px] items-center text-primary-black">
        FanGift's Marketplace
        {{ 'icon-external.svg' | asset_url | img_tag }}
      </a>
    </li>
  </ul>
</nav>